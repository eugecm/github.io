<!DOCTYPE html>
<html lang="en">

<head>
  <title>Eugenio's Blog</title>
  <html lang="en">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light dark">
  <link rel="icon" type="image/png" href="data:image/png;base64,">
  <style>
@media (prefers-color-scheme: dark){
	body {
		background:#000
	}
}
	body{
		margin:1em auto;
		max-width:40em;
		padding:0 .62em 3.24em;
		font:1.2em/1.62 sans-serif
	}
	h1,h2,h3 {
		line-height:1.2
	}
	pre {
		padding: 1em;
		white-space: pre-wrap
	}
	blockquote {
	  background: #f9f9f9;
	  border-left: 10px solid #ccc;
	  margin: 1.5em 10px;
	  padding: 0.5em 10px;
	}
	@media print{
		body{
			max-width:none
		}
	}
  </style>
</head>

<body>
  <h1 class="title">
    Eugenio Cano-Manuel Mendoza
  </h1>
  <ul>
	  <li><a href="https://eugenio.sh/blog/">Posts</a></li>
	  
	  <li><a href="https://eugenio.sh/bookmarks/">Bookmarks</a></li>
	  
	  <li><a href="https://eugenio.sh/about/">About me</a></li>
  </ul>
  <section class="section">
    <div class="container">
      
<h1 class="title">
  On Backups
</h1>
<p class="subtitle"><strong>2022-09-10</strong></p>
<p>I want a backup solution that:</p>
<ol>
<li>Follows the <a href="https://www.backblaze.com/blog/the-3-2-1-backup-strategy/">3-2-1 strategy</a></li>
<li>Is <a href="https://www.gkogan.co/blog/simple-systems/">simple</a></li>
<li>Is cheap</li>
<li>Is secure</li>
</ol>
<p>This is what I've come up after almost 2 years of making backups for my personal data.</p>
<h2 id="the-3-2-1-strategy">The 3-2-1 strategy</h2>
<blockquote>
<p>3 copies of data, 2 different media, 1 copy off-site.</p>
</blockquote>
<p>Copy 1: The SSD on my machine.</p>
<p>Copy 2: The <a href="https://en.wikipedia.org/wiki/Standard_RAID_levels#RAID_1">raid-1</a> spinning rust connected to my Raspberry Pi.</p>
<p>Copy 3: &quot;Cloud&quot; storage on <a href="https://www.backblaze.com/b2/cloud-storage.html">Backblaze B2</a>.</p>
<p>I've also added a 4th copy which lives on another hard drive connected to the
my main machine, where &quot;Copy 1&quot; is. This is only to avoid copying files over
the network in case my main hard drive fails. It's more of a nice-to-have.</p>
<h2 id="simple">Simple</h2>
<p>I'm using <a href="https://restic.net/">restic</a> to create backups. Now, there are
simpler and more established solutions out there like <code>rsync</code>, where all you do
is copy files somewhere else and call it a day. <code>restic</code>, on the other hand,
produces some opaque artifacts that can only be read by <code>restic</code>, so you're
kind of locked into the software when it comes to managing your files.</p>
<p>The reason I chose restic over rsync is because you get a set of features that
make it easy to implement the rest of the requirements (cheap &amp; secure) while
still having an easy-to-use interface, even if the underlying implementation is
not as straight-forward as rysnc's. My favourite features from restic are:</p>
<ul>
<li><strong>Encryption</strong>. Everything is encrypted, so my backups can live on a
third-party server and I don't have to worry about prying eyes.</li>
<li><strong>Many backends</strong> implemented, including S3 and SFTP. This gives me flexibility
when it comes to choosing where to store the backups. Note that S3 not only
gives you access to AWS but also any other file storage server that implements
the S3 interface (DigitalOcean, Wasabi, Backblaze etc).</li>
<li><strong>FUSE mount</strong>. I can access the files without having to download backups.</li>
<li><strong>Versioning</strong>. In case I accidentally backup a corrupted file.</li>
<li><strong>Incremental backups</strong>.</li>
</ul>
<h2 id="cheap">Cheap</h2>
<p>My desktop PC and my Raspberry Pi are &quot;free&quot; so to speak, in the sense that
I've already paid for them, even before I started making backups, and
electricity costs are negligible for both. The main cost is the third off-site
copy which currently lives on Backblaze B2. The price is very reasonable (I'm
paying less than 30 cents a month). If it ever becomes a problem I can easily
switch to another provider.</p>
<h2 id="secure">Secure</h2>
<p><code>restic</code> manages encryption and verifies that the backups have not been tampered
with. I'm not a security expert, but I've seen
<a href="https://words.filippo.io/restic-cryptography/">Filippo's</a> seal of approval and
that's good enough for me from a confidentiality and integrity point of view.</p>
<p>There's a <a href="https://www.backblaze.com/blog/whats-the-diff-3-2-1-vs-3-2-1-1-0-vs-4-3-2/">more comprehensive
version</a>
of the 3-2-1 rule that adds an offline+immutable backup to the mix to protect
from hackers that have accessed the infrastructure. I haven't figured out how
to implement this in my workflow yet, perhaps an external hard drive that I
update semi-regularly will suffice.</p>
<h2 id="worth-mentioning-timeshift-btrfs">Worth mentioning: Timeshift + Btrfs</h2>
<p><a href="https://en.wikipedia.org/wiki/Btrfs">Btrfs</a> deserves a whole blog post, but
since we're on the subject of data recovery I figured it's worth noting that
Btrfs snapshots are an excellent tool for when you need to quickly rollback to
a previous version of your hard drive and restoring from backups would be
overkill. I'm talking about restoring system files that that have been
corrupted or deleted due to a bad update, as opposed to your hard-drive dying.</p>
<p><a href="https://github.com/teejee2008/timeshift">Timeshift</a> makes the whole snapshot
experience a breeze. The UI lets you create snapshots on-demand, schedule
snapshots, and restore. It also supports creating snapshots using <code>rsync</code>, but
it's not as fast as Btrfs snapshots.</p>


    </div>
  </section>
</body>

</html>
