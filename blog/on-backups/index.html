<!DOCTYPE html>
<html><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Personal blog">
    
    <link rel="icon"
        href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABOElEQVQ4T+1RvUoDQRicb89kLz8HQiw0jc9gJVoJ2toIClaWeQNfwjewsLARtLRVsFIkErtoEcGkSFLkQLzL5fbifusayBnE5joLF5ZZZmfmG3ap/tSqkaEjAJ7dWVYAg0N6aL68Jxqer5wsZlSkRl6Y8CvA9CIH5+1ypoC95RBLRY3/gL/yBjyIBV33C5m+cXNxhAWXDdWbrQaBVjK5UzE9UuO5U2WtahBOacqrWFXfgmB/NnTe886kK7spx3qYjPmYfpt8eXO/JgTdzt4xm/XtjdW7n3p67Q52IGhXgNIwZq6o8XhrVixzuSshhD/lGMY4ZC6o3feDosyXrQFFVyIcxShZVMkHHEdM9FozZH4Ow1ihXHARWbSBiFQSUqfvn9jhB8YYQbaExUkXC5hWssdvLtUQG+bTT0IovzSmqlJoAAAAAElFTkSuQmCC">
    <title>On Backups</title>
    <style>
    	@media (prefers-color-scheme: dark){
    		body {color:#fff;background:#000}
    		a:link {color:#cdf}
    		a:hover, a:visited:hover {color:#def}
    		a:visited {color:#dcf}
    	}
    	body{
    		margin:1em auto;
    		max-width:40em;
    		padding:0 .62em;
    		font:1.2em/1.62 sans-serif
    	}
    	h1,h2,h3 {
    		line-height:1.2
    	}
    	@media print{
    		body{
    			max-width:none
    		}
    	}
    </style>
</head>
<body><header id="banner">
    <h2><a href="https://eugenio.sh">Eugenio Cano-Manuel Mendoza</a></h2>
    <nav>
        <ul>
            <li>
                <a href="/about/" title="">About</a>
            </li><li>
                <a href="/blog/" title="">Posts</a>
            </li>
        </ul>
    </nav>
</header>
<main id="content">
<article>
    <header id="post-header">
        <h1>On Backups</h1>
        <div>
                <time>Sep 10, 2022</time>
            </div>
    </header><p>Let me get straight to the point. I want a backup solution that:</p>
<ol>
<li>Lets me follow the <a href="https://www.backblaze.com/blog/the-3-2-1-backup-strategy/">3-2-1 strategy</a> very easily</li>
<li>Is <a href="https://www.gkogan.co/blog/simple-systems/">simple</a></li>
<li>Is cheap</li>
<li>Is secure</li>
</ol>
<h2 id="the-3-2-1-strategy">The 3-2-1 strategy</h2>
<blockquote>
<p>3 copies of data, 2 different media, 1 copy off-site.</p>
</blockquote>
<p>Copy 1: The SSD on my machine.</p>
<p>Copy 2: The <a href="https://en.wikipedia.org/wiki/Standard_RAID_levels#RAID_1">raid-1</a> spinning rust connected to my Raspberry Pi.</p>
<p>Copy 3: &ldquo;Cloud&rdquo; storage on <a href="https://www.backblaze.com/b2/cloud-storage.html">Backblaze B2</a>.</p>
<p>I&rsquo;ve also added a 4th copy which lives on another hard drive connected to the
my main machine, where &ldquo;Copy 1&rdquo; is. This is only to avoid copying files over
the network in case my main hard drive fails. It&rsquo;s more of a nice-to-have.</p>
<h2 id="simple">Simple</h2>
<p>I&rsquo;m using <a href="https://restic.net/">restic</a> to create backups. Now, there are
simpler and more established solutions out there like <code>rsync</code>, where all you do
is copy files somewhere else and call it a day. <code>restic</code>, on the other hand,
produces some opaque artifacts that can only be read by <code>restic</code>, so you&rsquo;re
kind of locked into the software when it comes to managing your files.</p>
<p>But the reason I chose restic over rsync is because you get a set of features that
make it easy to implement the rest of the requirements (cheap &amp; secure) while
still having an easy-to-use interface, even if the underlying implementation is
not as straight-forward as rysnc&rsquo;s. My favourite features are:</p>
<ul>
<li><strong>Encryption</strong>. Everything is encrypted, so my backups can live on a
third-party server and I don&rsquo;t have to worry about prying eyes (too much).</li>
<li><strong>Many backends</strong> supported, including S3 and SFTP. This gives me flexibility
when it comes to choosing where to store the backups. Note that S3 not only
gives you access to AWS but also any other file storage server that implements
the S3 interface (DigitalOcean, Wasabi, Backblaze etc).</li>
<li><strong>FUSE mount</strong>. I can access the files without having to fully download backups.</li>
<li><strong>Versioning</strong>. In case I accidentally backup a corrupted file.</li>
<li><strong>Incremental backups</strong>.</li>
</ul>
<h2 id="cheap">Cheap</h2>
<p>My desktop PC and my Raspberry Pi are &ldquo;free&rdquo; so to speak, in the sense that
they&rsquo;ve already been paid for, electricity costs are negligible for both. The
main cost is the third off-site copy which currently lives on Backblaze B2. The
price is very reasonable (I&rsquo;m paying less than 30 cents a month) and if it ever
becomes a problem I can easily switch to another provider.</p>
<h2 id="secure">Secure</h2>
<p><code>restic</code> manages encryption and verifies that the backups have not been tampered
with. I&rsquo;m not a security expert, but I&rsquo;ve seen
<a href="https://words.filippo.io/restic-cryptography/">Filippo&rsquo;s</a> seal of approval and
that&rsquo;s good enough for me from a confidentiality and integrity point of view.</p>
<p>There&rsquo;s a <a href="https://www.backblaze.com/blog/whats-the-diff-3-2-1-vs-3-2-1-1-0-vs-4-3-2/">more comprehensive
version</a>
of the 3-2-1 rule that adds an offline+immutable backup to the mix to protect
from hackers that have accessed the infrastructure. I haven&rsquo;t figured out how
to integrate this in my workflow yet, perhaps an external hard drive that I
update semi-regularly will suffice.</p>
<h2 id="worth-mentioning-timeshift--btrfs">Worth mentioning: Timeshift + Btrfs</h2>
<p><a href="https://en.wikipedia.org/wiki/Btrfs">Btrfs</a> deserves a whole blog post of its
own, but since we&rsquo;re on the subject of data recovery I figured it&rsquo;s worth
noting that Btrfs snapshots are an excellent tool for when you need to quickly
rollback to a previous version of your hard drive and restoring from backups
would be a complete overkill. I&rsquo;m talking about restoring system files that
that have been corrupted or deleted due to a bad update, as opposed to a
failing hard-drive.</p>
<p><a href="https://github.com/teejee2008/timeshift">Timeshift</a> is what makes the whole
snapshot experience a breeze. The UI lets you create snapshots on-demand,
schedule snapshots, and restore. It also supports creating snapshots using
<code>rsync</code>, but it&rsquo;s not as fast as Btrfs snapshots.</p>
</article>

        </main><footer id="footer">
    Copyright Â© 2022 Eugenio Cano-Manuel Mendoza
</footer>
</body>
</html>
